---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/api/v1/conversions":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: List conversions
      operationId: getConversions
      description: List conversion tasks for user
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 4f1d2d58-d02c-4b77-b74e-c6ca35deb98d
                space_id: 435a745f-887a-418f-be5e-f922589d827e
                space_key: khN6v75p
                progress: 0.0
                status: inProgress
                start_time: 2024-08-27 12:51:12 UTC
                end_time: 
                conversion_job_id: 54397546-b226-4b74-8270-923454c3e186
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                meta:
                  dest_resource_id: 63f9d786-6ea8-4c33-a173-9d3d469c4df4
                  dest_version_id: a307cc12-9a6f-42d2-bb1c-644c14809028
              - id: 2dc58f8e-e71e-4556-b228-72faacce100d
                space_id: 435a745f-887a-418f-be5e-f922589d827e
                space_key: khN6v75p
                progress: 0.0
                status: inProgress
                start_time: 2024-08-27 12:51:12 UTC
                end_time: 
                conversion_job_id: f1e11c65-7016-4d89-bbf3-5ab92f7c9a33
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                meta:
                  dest_resource_id: 071b31dc-e7fc-40bd-bcc8-527ad408be83
                  dest_version_id: 691b67c7-f710-4155-929b-33aa96d4afea
              - id: 69dd4069-87e5-49a0-b134-0599e541df8e
                space_id: 435a745f-887a-418f-be5e-f922589d827e
                space_key: khN6v75p
                progress: 0.0
                status: inProgress
                start_time: 2024-08-27 12:51:12 UTC
                end_time: 
                conversion_job_id: b17c87fd-fb24-465e-91a4-574ba272a440
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                meta:
                  dest_resource_id: 34fae607-5e01-450b-b825-a2217d295c26
                  dest_version_id: f8ff7318-35c8-4549-9129-e38130abc407
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show conversion
      operationId: getConversion
      description: Get description of Conversion Task
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: eafe3bb0-f019-4fb4-bf1e-5235b91ee8a5
                space_id: 01672b30-9edb-4c8b-af58-59b72c27943d
                space_key: GGyTh766
                progress: 0.0
                status: inProgress
                start_time: 2024-08-27 12:51:12 UTC
                end_time: 
                conversion_job_id: b3474109-9c5f-4482-8508-fb42b510ff49
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                meta:
                  dest_resource_id: b84d5c8c-2283-4d34-b37b-22d699940732
                  dest_version_id: ac25992d-5cb1-4434-979b-b7fbdede1a82
              schema:
                "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}/logs":
    parameters:
    - name: id
      in: path
      description: Conversion Task id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: logs conversion
      operationId: getConversionLogs
      description: Get logs of Conversion Task (redirect to logs file)
      responses:
        '302':
          description: successful
  "/api/v1/op/convert-anonym":
    post:
      summary: convert_anonym op
      operationId: convertAnonym
      description: Start anonym conversion
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 5ac4faf9-74b2-4599-acb1-73279181f1ea
                space_id: adef199c-1aff-407c-94a4-024a92431787
                space_key: vq2jrxZR
                progress: 0.0
                status: inProgress
                start_time: 2024-08-27 12:51:12 UTC
                end_time: 
                conversion_job_id: f4a7d5cd-fa47-454c-a102-9ae3491ebefc
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                meta:
                  dest_resource_id: 99e54c41-e71c-4ecd-893e-e02af12b07e4
                  dest_version_id: 43ae4079-e02b-446a-b692-d5ccbb635f1c
              schema:
                "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
  "/users":
    post:
      summary: create registration
      operationId: signUp
      description: Sign up new user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: a882fe42-3e4c-46b3-8478-561c925adf35
                  email: valid@email.com
                  created_at: '2024-08-27T12:51:12.694Z'
                  updated_at: '2024-08-27T12:51:12.694Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '422':
          description: user already exist
          content:
            application/json:
              example:
                errors:
                  password_confirmation:
                  - doesn't match Password
                  password:
                  - is too short (minimum is 6 characters)
                  email:
                  - has already been taken
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              - password_confirmation
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
                password_confirmation:
                  type: string
                  description: password confirmation, should match password
  "/api/v1/resources/":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: list resources
      operationId: getResources
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 684a8a6b-4259-45ed-ab24-dcdc233971a5
                space_id: a6d411b0-bca9-45a5-b1ed-bd2c1a37bd24
                space_key: cCJQGD9T
                name: incidunt.ifc
                current_id: 
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
              - id: 5d0ea867-1bec-43c7-9702-21406f75ad27
                space_id: a6d411b0-bca9-45a5-b1ed-bd2c1a37bd24
                space_key: cCJQGD9T
                name: enim.ifc
                current_id: 
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
              - id: f6e1caf9-95c1-4d48-80a5-12cbec2ba69f
                space_id: a6d411b0-bca9-45a5-b1ed-bd2c1a37bd24
                space_key: cCJQGD9T
                name: quam.ifc
                current_id: 
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/resource"
  "/api/v1/resources/{id}":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource
      operationId: getResource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: a0598424-545c-4206-8499-b7bc4decd929
                space_id: 99cc3230-59b2-4b05-ad5f-155bbe75e016
                space_key: 96LvXrXO
                name: eveniet.ifc
                current_id: 
                created_at: 2024-08-27 12:51:12 UTC
                updated_at: 2024-08-27 12:51:12 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: 99cc3230-59b2-4b05-ad5f-155bbe75e016
                  space_key: 96LvXrXO
                  has_link_password: false
              schema:
                "$ref": "#/components/schemas/resource_extended"
    delete:
      summary: delete resource
      operationId: deleteResource
      responses:
        '204':
          description: successful
  "/api/v1/resources/convert_create":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_create resource
      operationId: convertCreateResource
      description: Create new Resource through conversion, Resource.current version
        is not ready
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                resource:
                  id: ae87f5e3-4f22-41fe-8ed8-ff6c7ae1ecb2
                  space_id: 8f4b27a8-4b4e-42ff-9339-8761a98349a0
                  space_key: iqJPkkTC
                  name: small-model.stp
                  current_id: 65fe9eb9-6a89-48d1-8a46-82e5b0636f23
                  created_at: '2024-08-27T12:51:12.992Z'
                  updated_at: '2024-08-27T12:51:13.012Z'
                task:
                  id: 43fb809c-2ca4-4f19-a8c4-f960c7399e99
                  space_id: 8f4b27a8-4b4e-42ff-9339-8761a98349a0
                  space_key: iqJPkkTC
                  progress: 0.0
                  status: inProgress
                  start_time: '2024-08-27T12:51:12.975Z'
                  end_time: 
                  conversion_job_id: d2ffa16e-93a2-4e1c-ae5e-920f5739bd3b
                  created_at: '2024-08-27T12:51:12.979Z'
                  updated_at: '2024-08-27T12:51:13.014Z'
                  meta:
                    dest_resource_id: ae87f5e3-4f22-41fe-8ed8-ff6c7ae1ecb2
                    dest_version_id: 65fe9eb9-6a89-48d1-8a46-82e5b0636f23
              schema:
                type: object
                properties:
                  resource:
                    "$ref": "#/components/schemas/resource"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
                required:
                - resource
                - task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/convert_update":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_update resource
      operationId: convertUpdateResource
      description: Create new Version through conversion, Resource.current version
        is not changed
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                version:
                  id: d68a297c-aa5e-43e7-9d88-c9b850ca9b88
                  space_id: 3d1368b6-d467-41fc-857a-0de37ef12fd0
                  space_key: 1w1bmj1m
                  resource_id: 616cba09-027a-44f8-ac7d-1f9ba76fc91d
                  status: pending
                  is_version: true
                  created_at: '2024-08-27T12:51:13.118Z'
                  updated_at: '2024-08-27T12:51:13.118Z'
                task:
                  id: a4df8441-9f75-4820-99e3-e3272c701bcf
                  space_id: 3d1368b6-d467-41fc-857a-0de37ef12fd0
                  space_key: 1w1bmj1m
                  progress: 0.0
                  status: inProgress
                  start_time: '2024-08-27T12:51:13.111Z'
                  end_time: 
                  conversion_job_id: 14f98c8c-818f-460f-9d00-e3de91c2da95
                  created_at: '2024-08-27T12:51:13.112Z'
                  updated_at: '2024-08-27T12:51:13.128Z'
                  meta:
                    dest_resource_id: 616cba09-027a-44f8-ac7d-1f9ba76fc91d
                    dest_version_id: d68a297c-aa5e-43e7-9d88-c9b850ca9b88
              schema:
                type: object
                properties:
                  version:
                    "$ref": "#/components/schemas/version"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
                required:
                - version
                - task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/set_current":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    patch:
      summary: set_current resource
      operationId: setResourceCurrent
      description: Change current resource version
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 751612af-af1f-4ed2-ab27-3871e265189c
                space_id: 1238b47f-0096-4f84-b692-df4e0bae1d34
                space_key: ry5KDIe5
                name: adipisci.ifc
                current_id: 67d11cdb-6a3a-4064-b7b8-7b4f88d5fc1b
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: 1238b47f-0096-4f84-b692-df4e0bae1d34
                  space_key: ry5KDIe5
                  has_link_password: false
              schema:
                "$ref": "#/components/schemas/resource"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - current_id
              properties:
                current_id:
                  type: string
                  description: New Resource current id, if on one of resource versions
        required: true
  "/users/sign_in":
    post:
      summary: create session
      operationId: signIn
      description: Sign in user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: ec4e0aab-db71-48ba-a336-cd6e0c229c65
                  email: teresita.white@blanda-marks.example
                  created_at: '2024-08-27T12:51:13.217Z'
                  updated_at: '2024-08-27T12:51:13.217Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '401':
          description: Unauthorized
          content:
            application/json:
              example:
                errors: not authenticated
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
  "/api/v1/resources/{id}/share-options":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource's share_options
      operationId: getShareOptions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                link_access: none
                space_id: 51f52e86-8231-466a-91cc-31663356657d
                space_key: JxDbQ6wM
                has_link_password: false
    patch:
      summary: update resource's share_options
      operationId: updateShareOptions
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: unprocessable entity
          content:
            application/json:
              example:
                errors:
                  link_password:
                  - is too short (minimum is 8 characters)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_access:
                  type: string
                  description: Resource view access by link, possible values :none,
                    :view
                  enum:
                  - none
                  - view
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/resources/{id}/share-options/auth-password":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: enter password for resource share_option
      operationId: resourceAuthPassword
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: forbidden
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/versions/{id}":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show version
      operationId: getVersion
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 2b9f6394-76a5-4855-b100-1965753e21fe
                space_id: 0dd3ad63-47ac-474e-891d-4d822ab04a31
                space_key: hSXwpwGJ
                resource_id: 6d651dda-13a0-4c43-afda-def50dc01842
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              schema:
                "$ref": "#/components/schemas/version"
  "/api/v1/versions/{id}/files":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: files version
      operationId: getVersionFiles
      responses:
        '200':
          description: successful
          content:
            application/json:
              example: []
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/asset_file"
  "/api/v1/resources/{id}/versions":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get versions
      operationId: getResourceVersions
      description: Resource versions, asset items each of which is versioned representation
        of resource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 568c3fc6-2905-46bd-a285-900081960365
                space_id: 63dfaf86-fd87-459a-8bc8-79c0204f5f7b
                space_key: UM4j0I8q
                resource_id: 2e1fe9bd-7797-4fe8-bf3d-85b468cb134b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 423712fa-0960-4260-acf4-355c99b77470
                space_id: 63dfaf86-fd87-459a-8bc8-79c0204f5f7b
                space_key: UM4j0I8q
                resource_id: 2e1fe9bd-7797-4fe8-bf3d-85b468cb134b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 5a7ac596-60ae-461a-bdff-47fd6aa2ff56
                space_id: 63dfaf86-fd87-459a-8bc8-79c0204f5f7b
                space_key: UM4j0I8q
                resource_id: 2e1fe9bd-7797-4fe8-bf3d-85b468cb134b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
  "/api/v1/resources/{id}/asset-items":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get asset items
      operationId: getResourceAssetItems
      description: Resource asset items, not only versions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: fa1c9373-4914-4697-9f97-c30d15940bba
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: false
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 1d9ac231-e140-4ef1-84b9-3f94188d2bbb
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 2e0c0c40-4aa2-4372-a662-99e69d367cb1
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: false
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 7a74c742-b54b-4aad-8a4e-3c1e99986dd8
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: dcafa55f-9281-4f40-af1a-2bd9cc9e1c85
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: false
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              - id: 880bbabb-ed93-4e94-b9d0-31360d8bc5d0
                space_id: 31533778-573c-425b-9c58-9d6d06022712
                space_key: XW6W8Gu3
                resource_id: 672f37e2-78db-4424-b17b-ef8a7f37660b
                status: ready
                is_version: true
                created_at: 2024-08-27 12:51:13 UTC
                updated_at: 2024-08-27 12:51:13 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
components:
  schemas:
    resource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        name:
          type: string
        current_id:
          type: string
          format: uuid
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - id
      - space_id
      - space_key
      - name
      - created_at
      - updated_at
    share_options:
      type: object
      properties:
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        link_access:
          type: string
        has_link_password:
          type: boolean
      required:
      - link_access
      - space_id
      - space_key
      - has_link_password
    resource_extended:
      allOf:
      - "$ref": "#/components/schemas/resource"
      - type: object
        properties:
          permissions:
            type: object
            properties:
              manage:
                type: boolean
              share:
                type: boolean
          share_options:
            "$ref": "#/components/schemas/share_options"
    version:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        status:
          "$ref": "#/components/schemas/version_status"
        resource_id:
          type: string
          format: uuid
        is_version:
          type: boolean
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - id
      - space_id
      - space_key
      - status
      - resource_id
      - is_version
      - created_at
      - updated_at
    asset_file:
      type: object
      properties:
        filename:
          type: string
        size:
          type: integer
        signedUrl:
          type: string
        originFilePath:
          type: string
      required:
      - filename
      - size
      - signedUrl
      - originFilePath
    version_status:
      type: string
      enum:
      - pending
      - in_progress
      - ready
      - failed
      - canceled
    conversion_status:
      type: string
      enum:
      - finished
      - inProgress
      - failed
      - canceled
      - canceling
    conversion_task:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        status:
          "$ref": "#/components/schemas/conversion_status"
        progress:
          type: number
          minimum: 0
          maximum: 1
        start_time:
          type: string
          format: date_time
          nullable: true
        end_time:
          type: string
          format: date_time
          nullable: true
        conversion_job_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
        meta:
          type: object
          properties:
            dest_resource_id:
              type: string
              nullable: true
            dest_version_id:
              type: string
              nullable: true
      required:
      - id
      - space_id
      - space_key
      - status
      - progress
      - conversion_job_id
      - end_time
      - created_at
      - updated_at
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3050
