---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/api/v1/conversions":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: List conversions
      operationId: getConversions
      description: List conversion tasks for user
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 07a1c488-b472-40fb-ae88-f152564cebd0
                space_id: 70424cf6-e42e-46bd-87c6-a2073f201b21
                space_key: JvL2tC11
                progress: 0.0
                status: inProgress
                start_time: 2024-08-23 11:06:55 UTC
                end_time: 
                conversion_job_id: e06d3f48-1f43-4edc-80bd-489daa09d1ed
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                meta:
                  dest_resource_id: aea42ef6-1361-4f80-b16e-62cd226fc9b1
                  dest_version_id: 7037129e-78df-4e40-9f38-19ed85d503c5
              - id: 8e9d899a-12d2-4866-adf5-02461f1b747a
                space_id: 70424cf6-e42e-46bd-87c6-a2073f201b21
                space_key: JvL2tC11
                progress: 0.0
                status: inProgress
                start_time: 2024-08-23 11:06:55 UTC
                end_time: 
                conversion_job_id: 2484fda3-191a-400a-b12f-8e1a9c3e5457
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                meta:
                  dest_resource_id: 84ca5cea-60fc-4406-b016-da75ad5933e7
                  dest_version_id: e18559c3-2cf8-4313-a25c-721094add2bd
              - id: 1f19cc5f-7847-41f9-bd7d-ba3a44f5725f
                space_id: 70424cf6-e42e-46bd-87c6-a2073f201b21
                space_key: JvL2tC11
                progress: 0.0
                status: inProgress
                start_time: 2024-08-23 11:06:55 UTC
                end_time: 
                conversion_job_id: 530c2186-b3f7-4bdd-8802-27ad21f7a32a
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                meta:
                  dest_resource_id: 85c8b60a-e5f1-43ba-823b-eed92ec921db
                  dest_version_id: 00a62919-5da0-44d1-ba29-0128bdbdc245
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show conversion
      operationId: getConversion
      description: Get description of Conversion Task
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 46bd60f0-ac20-44ae-96c9-32b437a1f8f6
                space_id: 97c720d1-3c9e-4917-b16f-db64ed9f7e56
                space_key: fNn8tcPv
                progress: 0.0
                status: inProgress
                start_time: 2024-08-23 11:06:55 UTC
                end_time: 
                conversion_job_id: 2eaf1866-9258-454a-84bc-4b635051664a
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                meta:
                  dest_resource_id: b037542d-4ee6-4d1c-9b85-7224a1d0d4ed
                  dest_version_id: 4ee40614-fb0a-437b-b148-c8050852521f
              schema:
                "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}/logs":
    parameters:
    - name: id
      in: path
      description: Conversion Task id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: logs conversion
      operationId: getConversionLogs
      description: Get logs of Conversion Task (redirect to logs file)
      responses:
        '302':
          description: successful
  "/api/v1/op/convert-anonym":
    post:
      summary: convert_anonym op
      operationId: convertAnonym
      description: Start anonym conversion
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 4554513a-5f20-40b7-97db-5275f3001c14
                space_id: 178c1f9b-e189-4cea-8b66-9dde26175ab9
                space_key: XwuLMLWI
                progress: 0.0
                status: inProgress
                start_time: 2024-08-23 11:06:55 UTC
                end_time: 
                conversion_job_id: 53be3161-dbe6-4ee1-8080-ae87caf1e6af
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                meta:
                  dest_resource_id: 19655ec4-6d2a-4233-8e34-a73b1e934f27
                  dest_version_id: 36ca9024-42bc-4bec-bc21-b4e05b5d7608
              schema:
                "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
  "/users":
    post:
      summary: create registration
      operationId: signUp
      description: Sign up new user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: 1b5ef6a9-3906-415d-a6b3-5da35f4ac4c6
                  email: valid@email.com
                  created_at: '2024-08-23T11:06:55.609Z'
                  updated_at: '2024-08-23T11:06:55.609Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '422':
          description: user already exist
          content:
            application/json:
              example:
                errors:
                  password_confirmation:
                  - doesn't match Password
                  password:
                  - is too short (minimum is 6 characters)
                  email:
                  - has already been taken
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              - password_confirmation
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
                password_confirmation:
                  type: string
                  description: password confirmation, should match password
  "/api/v1/resources/":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: list resources
      operationId: getResources
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: b08588be-7013-4bcf-bcd3-8f0e66050e7d
                space_id: 6cec00e4-d2bc-4d0a-a9ad-1752ad9d9fea
                space_key: hxCHIp3N
                name: alias.ifc
                current_id: 
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
              - id: 3cf73512-3162-43dc-ba84-6a499cc3f49a
                space_id: 6cec00e4-d2bc-4d0a-a9ad-1752ad9d9fea
                space_key: hxCHIp3N
                name: ullam.ifc
                current_id: 
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
              - id: fb8a41c2-5113-4f60-a211-815ab7b8db21
                space_id: 6cec00e4-d2bc-4d0a-a9ad-1752ad9d9fea
                space_key: hxCHIp3N
                name: non.ifc
                current_id: 
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/resource"
  "/api/v1/resources/{id}":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource
      operationId: getResource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: af45c361-19a3-40e9-a28d-83632a1fdb71
                space_id: 55d34c8f-5960-4ea2-befa-51a85b18d5ce
                space_key: l3mkeAwz
                name: molestiae.ifc
                current_id: 
                created_at: 2024-08-23 11:06:55 UTC
                updated_at: 2024-08-23 11:06:55 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: 55d34c8f-5960-4ea2-befa-51a85b18d5ce
                  space_key: l3mkeAwz
                  has_link_password: false
    delete:
      summary: delete resource
      operationId: deleteResource
      responses:
        '204':
          description: successful
  "/api/v1/resources/convert_create":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_create resource
      operationId: convertCreateResource
      description: Create new Resource through conversion, Resource.current version
        is not ready
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                resource:
                  id: 7d6a4be5-d156-451c-970a-7a4e6d9c1418
                  space_id: c829f162-a933-4413-aa54-08b9d31c80b9
                  space_key: rO0rUeaw
                  name: small-model.stp
                  current_id: 01fc8391-f01a-4844-b066-d4521e8b5fba
                  created_at: '2024-08-23T11:06:55.877Z'
                  updated_at: '2024-08-23T11:06:55.890Z'
                task:
                  id: 795ea9f1-4137-44cc-875e-830d52aff09d
                  space_id: c829f162-a933-4413-aa54-08b9d31c80b9
                  space_key: rO0rUeaw
                  progress: 0.0
                  status: inProgress
                  start_time: '2024-08-23T11:06:55.868Z'
                  end_time: 
                  conversion_job_id: fd7f6b65-a246-4650-bec6-6feaa3ecf121
                  created_at: '2024-08-23T11:06:55.870Z'
                  updated_at: '2024-08-23T11:06:55.892Z'
                  meta:
                    dest_resource_id: 7d6a4be5-d156-451c-970a-7a4e6d9c1418
                    dest_version_id: 01fc8391-f01a-4844-b066-d4521e8b5fba
              schema:
                type: object
                properties:
                  resource:
                    "$ref": "#/components/schemas/resource"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
                required:
                - resource
                - task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/convert_update":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_update resource
      operationId: convertUpdateResource
      description: Create new Version through conversion, Resource.current version
        is not changed
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                version:
                  id: 6516d598-5c7a-482e-b288-e0b15c13c270
                  space_id: 7074d3c5-f9ef-400b-a64e-f5620c9b31bc
                  space_key: mpLGKiq5
                  resource_id: ec496d78-14ce-4b6d-b364-e22c1626d1e2
                  status: pending
                  is_version: true
                  created_at: '2024-08-23T11:06:55.997Z'
                  updated_at: '2024-08-23T11:06:55.997Z'
                task:
                  id: e0e30366-0935-482b-a8ae-e96551d33d2d
                  space_id: 7074d3c5-f9ef-400b-a64e-f5620c9b31bc
                  space_key: mpLGKiq5
                  progress: 0.0
                  status: inProgress
                  start_time: '2024-08-23T11:06:55.989Z'
                  end_time: 
                  conversion_job_id: 163dac59-bdab-4f48-8cb2-5e2c9527fca4
                  created_at: '2024-08-23T11:06:55.991Z'
                  updated_at: '2024-08-23T11:06:56.006Z'
                  meta:
                    dest_resource_id: ec496d78-14ce-4b6d-b364-e22c1626d1e2
                    dest_version_id: 6516d598-5c7a-482e-b288-e0b15c13c270
              schema:
                type: object
                properties:
                  version:
                    "$ref": "#/components/schemas/version"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
                required:
                - version
                - task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/set_current":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    patch:
      summary: set_current resource
      operationId: setResourceCurrent
      description: Change current resource version
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: f3a7171a-4854-447b-aff3-c9f6d940af6c
                space_id: f4040095-e42c-4325-bc62-dee13149d859
                space_key: DecwVm8W
                name: praesentium.ifc
                current_id: bbd0e864-60e3-4b10-b1c3-e1ea66cfa197
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: f4040095-e42c-4325-bc62-dee13149d859
                  space_key: DecwVm8W
                  has_link_password: false
              schema:
                "$ref": "#/components/schemas/resource"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - current_id
              properties:
                current_id:
                  type: string
                  description: New Resource current id, if on one of resource versions
        required: true
  "/users/sign_in":
    post:
      summary: create session
      operationId: signIn
      description: Sign in user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: 4e841684-db3d-41f8-935b-86fac5034b10
                  email: melany_hickle@cremin-nicolas.test
                  created_at: '2024-08-23T11:06:56.100Z'
                  updated_at: '2024-08-23T11:06:56.100Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '401':
          description: Unauthorized
          content:
            application/json:
              example:
                errors: not authenticated
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
  "/api/v1/resources/{id}/share-options":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource's share_options
      operationId: getShareOptions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                link_access: none
                space_id: d323f02f-46b1-423b-84a4-2f934a6dae0c
                space_key: zDzKaWVE
                has_link_password: false
    patch:
      summary: update resource's share_options
      operationId: updateShareOptions
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: unprocessable entity
          content:
            application/json:
              example:
                errors:
                  link_password:
                  - is too short (minimum is 8 characters)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_access:
                  type: string
                  description: Resource view access by link, possible values :none,
                    :view
                  enum:
                  - none
                  - view
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/resources/{id}/share-options/auth-password":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: enter password for resource share_option
      operationId: resourceAuthPassword
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: forbidden
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/versions/{id}":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show version
      operationId: getVersion
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 59b8ca01-f277-46da-8342-d0082d3bca4b
                space_id: e9d352a7-f15d-46a7-b11f-90f111a2a589
                space_key: CQZK0tnf
                resource_id: 898cf80f-c7b1-4631-bf16-d361502a5f7e
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              schema:
                "$ref": "#/components/schemas/version"
  "/api/v1/versions/{id}/files":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: files version
      operationId: getVersionFiles
      responses:
        '200':
          description: successful
          content:
            application/json:
              example: []
  "/api/v1/resources/{id}/versions":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get versions
      operationId: getResourceVersions
      description: Resource versions, asset items each of which is versioned representation
        of resource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 1fc8db21-7510-47cf-bad8-a224d359bdbf
                space_id: 96ebf1b0-1aae-4b51-870c-0c4d140cc25b
                space_key: PZ6uayPb
                resource_id: e38ca515-59ce-4eed-9302-9d6bb0796a37
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: 0db3da86-e8f2-479d-9d0d-1eb29eb1820a
                space_id: 96ebf1b0-1aae-4b51-870c-0c4d140cc25b
                space_key: PZ6uayPb
                resource_id: e38ca515-59ce-4eed-9302-9d6bb0796a37
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: c9f606d8-e153-47c2-abe7-b64c90e88a89
                space_id: 96ebf1b0-1aae-4b51-870c-0c4d140cc25b
                space_key: PZ6uayPb
                resource_id: e38ca515-59ce-4eed-9302-9d6bb0796a37
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
  "/api/v1/resources/{id}/asset-items":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get versions
      operationId: getResourceAssetItems
      description: Resource asset items, not only versions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 62628399-867b-429d-9d85-7c5287638eef
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: false
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: a2557abf-b073-46d6-8bcf-730b2cefbb7f
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: cd182d71-0e51-4897-9863-a916be03cc7d
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: false
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: eecc302e-37fa-4246-b553-a35a66aefd21
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: 9c9aa2e1-0149-4ae2-b67f-3064386e6b31
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: false
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              - id: 513db386-3a14-47cc-bb48-8d25ac947d15
                space_id: 69a58b23-47d5-4431-ac1d-3b3036181862
                space_key: dMqHiWgN
                resource_id: c36d44e7-a4c0-425f-a994-24230c058a84
                status: ready
                is_version: true
                created_at: 2024-08-23 11:06:56 UTC
                updated_at: 2024-08-23 11:06:56 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
components:
  schemas:
    resource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        name:
          type: string
        current_id:
          type: string
          format: uuid
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - id
      - space_id
      - space_key
      - name
      - created_at
      - updated_at
    version:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        status:
          "$ref": "#/components/schemas/version_status"
        resource_id:
          type: string
          format: uuid
        is_version:
          type: boolean
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - id
      - space_id
      - space_key
      - status
      - resource_id
      - is_version
      - created_at
      - updated_at
    version_status:
      type: string
      enum:
      - pending
      - in_progress
      - ready
      - failed
      - canceled
    conversion_status:
      type: string
      enum:
      - finished
      - inProgress
      - failed
      - canceled
      - canceling
    conversion_task:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
          format: uuid
        space_key:
          type: string
        status:
          "$ref": "#/components/schemas/conversion_status"
        progress:
          type: number
          minimum: 0
          maximum: 1
        start_time:
          type: string
          format: date_time
          nullable: true
        end_time:
          type: string
          format: date_time
          nullable: true
        conversion_job_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
        meta:
          type: object
          properties:
            dest_resource_id:
              type: string
              nullable: true
            dest_version_id:
              type: string
              nullable: true
      required:
      - id
      - space_id
      - space_key
      - status
      - progress
      - conversion_job_id
      - end_time
      - created_at
      - updated_at
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3050
