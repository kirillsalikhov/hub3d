---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/api/v1/conversions":
    get:
      summary: List conversions
      operationId: getConversions
      description: List conversion tasks for user
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 6428c1f8-d79d-4d03-a648-ee178d0836f1
                status: inProgress
                progress: '0.0'
                start_time: 2024-03-22 11:27:19 UTC
                end_time: 
                conversion_job_id: 58a277c9-bd17-4769-9e5c-e8fe14b757ec
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
                meta:
                  dest_resource_id: 7e4f026d-15be-4330-9209-ff31fd964077
                  dest_version_id: d9e6769b-a6b8-4d82-addd-256b63635187
              - id: 39730e2c-21bf-4eec-83c0-eaaeeca260b2
                status: inProgress
                progress: '0.0'
                start_time: 2024-03-22 11:27:19 UTC
                end_time: 
                conversion_job_id: d0259f02-7350-4ebc-a7de-d9662492492d
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
                meta:
                  dest_resource_id: 9c3fbe37-580d-4c5f-8c5c-7712cc95e120
                  dest_version_id: 524b0fdf-38a3-41d9-a1bc-5e4324f2103b
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    get:
      summary: show conversion
      operationId: getConversion
      description: Get description of Conversion Task
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: cd45b2eb-4fd2-4a1e-bae4-f7530948847e
                status: inProgress
                progress: '0.0'
                start_time: 2024-03-22 11:27:19 UTC
                end_time: 
                conversion_job_id: 13f0ca05-d15e-4fac-ac66-03097c8edf68
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
                meta:
                  dest_resource_id: 74331127-c7ab-47fd-b977-ae75748e3124
                  dest_version_id: 641053bb-3c48-4b58-ba69-554318dd2181
              schema:
                "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}/logs":
    parameters:
    - name: id
      in: path
      description: Conversion Task id
      required: true
      schema:
        type: string
    get:
      summary: logs conversion
      operationId: getConversionLogs
      description: Get logs of Conversion Task (redirect to logs file)
      responses:
        '302':
          description: successful
  "/api/v1/op/convert-anonym":
    post:
      summary: convert_anonym op
      operationId: convertAnonym
      description: Start anonym conversion
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: d8641515-a071-4775-bd24-a45d21783286
                status: inProgress
                progress: '0.0'
                start_time: 2024-03-22 11:27:19 UTC
                end_time: 
                conversion_job_id: f33694a6-75ae-444d-8915-198cc53adfe1
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
                meta:
                  dest_resource_id: 1fe66de7-8e5b-4a58-a97e-222e69a680b4
                  dest_version_id: f5fe2024-281c-487c-84f1-06cff6d75e32
              schema:
                "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
  "/api/v1/resources/{id}":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    get:
      summary: show resource
      operationId: getResource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 0f61d831-0668-4a78-9f74-5ea658d4b09d
                name: saepe.ifc
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
                current_id: 
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  has_link_password: false
  "/api/v1/resources/{id}/share-options":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    get:
      summary: show resource's share_options
      operationId: getShareOptions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                link_access: none
                has_link_password: false
    patch:
      summary: update resource's share_options
      operationId: updateShareOptions
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: unprocessable entity
          content:
            application/json:
              example:
                errors:
                  link_password:
                  - is too short (minimum is 8 characters)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_access:
                  type: string
                  description: Resource view access by link, possible values :none,
                    :view
                  enum:
                  - none
                  - view
                link_password:
                  type: string
                  format: password
  "/api/v1/resources/{id}/share-options/auth-password":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    post:
      summary: enter password for resource share_option
      operationId: resourceAuthPassword
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: forbidden
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_password:
                  type: string
                  format: password
  "/api/v1/versions/{id}":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    get:
      summary: show version
      operationId: getVersion
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: adec9d58-4160-4b73-8ea8-cc4da08d00d7
                resource_id: d2657d55-b03a-4544-9f0a-ab7e20a041ec
                created_at: 2024-03-22 11:27:19 UTC
                updated_at: 2024-03-22 11:27:19 UTC
  "/api/v1/versions/{id}/files":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    get:
      summary: files version
      operationId: getVersionFiles
      responses:
        '200':
          description: successful
          content:
            application/json:
              example: []
components:
  schemas:
    conversion_task:
      type: object
      properties:
        status:
          type: string
          example: finished
        progress:
          type: string
        start_time:
          type: string
          format: date_time
          nullable: true
        end_time:
          type: string
          format: date_time
          nullable: true
        conversion_job_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
        meta:
          type: object
          properties:
            dest_resource_id:
              type: string
              nullable: true
            dest_version_id:
              type: string
              nullable: true
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3050
