---
openapi: 3.0.1
info:
  title: API V1
  version: v1
paths:
  "/api/v1/conversions":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: List conversions
      operationId: getConversions
      description: List conversion tasks for user
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 6d8b33ae-5bd7-4c94-8443-681dfc7f13c7
                space_id: ce151184-7f74-403b-ac43-e2bd112d4ef5
                space_key: 6bloh9ds
                status: inProgress
                progress: '0.0'
                start_time: 2024-08-18 16:20:24 UTC
                end_time: 
                conversion_job_id: 596642e6-56fb-404d-9cc7-9b7dca3fb0b3
                created_at: 2024-08-18 16:20:24 UTC
                updated_at: 2024-08-18 16:20:24 UTC
                meta:
                  dest_resource_id: 2d4511f6-55c2-47f1-8813-97f2d6534200
                  dest_version_id: '038e0b6c-01c4-4dd2-9803-b1ba44dc879f'
              - id: 0f01530e-f0d2-46fe-8e10-e903b2e0ce45
                space_id: ce151184-7f74-403b-ac43-e2bd112d4ef5
                space_key: 6bloh9ds
                status: inProgress
                progress: '0.0'
                start_time: 2024-08-18 16:20:24 UTC
                end_time: 
                conversion_job_id: ab05cc52-ee68-4ac0-98a2-965f4bb92e97
                created_at: 2024-08-18 16:20:24 UTC
                updated_at: 2024-08-18 16:20:24 UTC
                meta:
                  dest_resource_id: 2e4d57e2-939b-436f-894e-e3a05719b58d
                  dest_version_id: 2143100f-cc8b-4a0f-8bc5-5f38ef2f899f
              - id: 125ebca4-d542-4a8b-bd77-9e62bbac266f
                space_id: ce151184-7f74-403b-ac43-e2bd112d4ef5
                space_key: 6bloh9ds
                status: inProgress
                progress: '0.0'
                start_time: 2024-08-18 16:20:24 UTC
                end_time: 
                conversion_job_id: e71220eb-95ad-472e-a540-bb86bb236d51
                created_at: 2024-08-18 16:20:24 UTC
                updated_at: 2024-08-18 16:20:24 UTC
                meta:
                  dest_resource_id: 9f172ba9-89da-42e8-af70-b0c18244eb79
                  dest_version_id: b2d124d0-c339-477c-9d6b-5dd41f9a696e
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}":
    parameters:
    - name: id
      in: path
      description: id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show conversion
      operationId: getConversion
      description: Get description of Conversion Task
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 5fc06751-7e2e-4d90-bf46-c35444a159d1
                space_id: 674a35ce-57ac-495c-9f58-43094ffdcdb6
                space_key: Bn2FrLBA
                status: inProgress
                progress: '0.0'
                start_time: 2024-08-18 16:20:24 UTC
                end_time: 
                conversion_job_id: 810dac1f-be9b-4acb-b267-1cc48750365d
                created_at: 2024-08-18 16:20:24 UTC
                updated_at: 2024-08-18 16:20:24 UTC
                meta:
                  dest_resource_id: 3f389c8f-cf3c-44f9-9b7f-804010a22ddd
                  dest_version_id: 3a9422d7-b422-4245-84ca-438f486c0d72
              schema:
                "$ref": "#/components/schemas/conversion_task"
  "/api/v1/conversions/{id}/logs":
    parameters:
    - name: id
      in: path
      description: Conversion Task id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: logs conversion
      operationId: getConversionLogs
      description: Get logs of Conversion Task (redirect to logs file)
      responses:
        '302':
          description: successful
  "/api/v1/op/convert-anonym":
    post:
      summary: convert_anonym op
      operationId: convertAnonym
      description: Start anonym conversion
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: d7cb9e5f-892a-4083-9574-a7a064a2a282
                space_id: af15d28c-59ec-48a3-96ba-518ea8ac38a5
                space_key: yRjrxLzu
                status: inProgress
                progress: '0.0'
                start_time: 2024-08-18 16:20:25 UTC
                end_time: 
                conversion_job_id: a154c021-456c-44e5-873c-3e39f839fdd6
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
                meta:
                  dest_resource_id: 906e821f-581d-4a99-89d1-ac2e8e14ec8e
                  dest_version_id: fda3df82-51d2-4cde-be03-ca2bdc5c0920
              schema:
                "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
  "/users":
    post:
      summary: create registration
      operationId: signUp
      description: Sign up new user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: b8f01c08-ed47-41ee-bfa4-0f2a35c9fd58
                  email: valid@email.com
                  created_at: '2024-08-18T16:20:25.253Z'
                  updated_at: '2024-08-18T16:20:25.253Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '422':
          description: user already exist
          content:
            application/json:
              example:
                errors:
                  password_confirmation:
                  - doesn't match Password
                  password:
                  - is too short (minimum is 6 characters)
                  email:
                  - has already been taken
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              - password_confirmation
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
                password_confirmation:
                  type: string
                  description: password confirmation, should match password
  "/api/v1/resources/":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: list resources
      operationId: getResources
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: cd8cae3a-c99c-44f6-99e8-e97246a37005
                space_id: dcdf3951-578e-4134-949b-2043f5729f1f
                space_key: 9nD8UaBp
                name: unde.ifc
                current_id: 
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
              - id: c27549f9-4c99-450b-a761-c41041112668
                space_id: dcdf3951-578e-4134-949b-2043f5729f1f
                space_key: 9nD8UaBp
                name: aut.ifc
                current_id: 
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
              - id: e549ea71-d44b-400d-8f2e-3fe6d6d50f9c
                space_id: dcdf3951-578e-4134-949b-2043f5729f1f
                space_key: 9nD8UaBp
                name: ut.ifc
                current_id: 
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/resource"
  "/api/v1/resources/{id}":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource
      operationId: getResource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: cb64520a-add6-4b20-8a52-88f830b5070f
                space_id: c417fd8c-6528-4626-a094-153251b9fa23
                space_key: HBdKZlxm
                name: vero.ifc
                current_id: 
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: c417fd8c-6528-4626-a094-153251b9fa23
                  space_key: HBdKZlxm
                  has_link_password: false
    delete:
      summary: delete resource
      operationId: deleteResource
      responses:
        '204':
          description: successful
  "/api/v1/resources/convert_create":
    parameters:
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_create resource
      operationId: convertCreateResource
      description: Create new Resource through conversion, Resource.current version
        is not ready
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                resource:
                  id: 6bb705d1-14ac-4d49-80e7-fae16157b757
                  space_id: bad94adc-6765-4472-ba7b-10db36f505e2
                  space_key: 8MZC1eAD
                  name: small-model.stp
                  current_id: 24271b78-a292-4908-b086-bbd8857d118c
                  created_at: '2024-08-18T16:20:25.626Z'
                  updated_at: '2024-08-18T16:20:25.642Z'
                task:
                  id: 017735f6-5869-4bbd-8e0a-210b558bfdec
                  space_id: bad94adc-6765-4472-ba7b-10db36f505e2
                  space_key: 8MZC1eAD
                  status: inProgress
                  progress: '0.0'
                  start_time: '2024-08-18T16:20:25.616Z'
                  end_time: 
                  conversion_job_id: cca26c48-b8ba-43a6-ae5f-7f1074985ba5
                  created_at: '2024-08-18T16:20:25.618Z'
                  updated_at: '2024-08-18T16:20:25.644Z'
                  meta:
                    dest_resource_id: 6bb705d1-14ac-4d49-80e7-fae16157b757
                    dest_version_id: 24271b78-a292-4908-b086-bbd8857d118c
              schema:
                type: object
                properties:
                  resource:
                    "$ref": "#/components/schemas/resource"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/convert_update":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: convert_update resource
      operationId: convertUpdateResource
      description: Create new Version through conversion, Resource.current version
        is not changed
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                version:
                  id: f21f93f9-f1bc-4b96-9746-5ab275a4ae1f
                  space_id: fa3fda28-116b-4db3-a020-5544b611ac19
                  space_key: CM09aFBN
                  resource_id: 52181c85-085f-487b-b729-1e9636c29066
                  status: pending
                  is_version: true
                  created_at: '2024-08-18T16:20:25.774Z'
                  updated_at: '2024-08-18T16:20:25.774Z'
                task:
                  id: 232aea3e-44cc-41c8-9b1d-39fe8c782c8a
                  space_id: fa3fda28-116b-4db3-a020-5544b611ac19
                  space_key: CM09aFBN
                  status: inProgress
                  progress: '0.0'
                  start_time: '2024-08-18T16:20:25.763Z'
                  end_time: 
                  conversion_job_id: b8289ef6-4c50-4da6-b444-87b6aab9446a
                  created_at: '2024-08-18T16:20:25.766Z'
                  updated_at: '2024-08-18T16:20:25.788Z'
                  meta:
                    dest_resource_id: 52181c85-085f-487b-b729-1e9636c29066
                    dest_version_id: f21f93f9-f1bc-4b96-9746-5ab275a4ae1f
              schema:
                type: object
                properties:
                  version:
                    "$ref": "#/components/schemas/version"
                  task:
                    "$ref": "#/components/schemas/conversion_task"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - input_file
              properties:
                input_file:
                  type: string
                  description: Active Storage signeID
        required: true
  "/api/v1/resources/{id}/set_current":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    patch:
      summary: set_current resource
      operationId: setResourceCurrent
      description: Change current resource version
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: 05c56ac6-4afc-4df5-81c7-bcdaeb4c0851
                space_id: 352d33c0-24ef-4a14-9fe6-8e414fb88151
                space_key: TZFSoNmf
                name: mollitia.ifc
                current_id: db098075-2e88-4cc8-8499-07823bbde764
                created_at: 2024-08-18 16:20:25 UTC
                updated_at: 2024-08-18 16:20:25 UTC
                permissions:
                  manage: true
                  share: true
                share_options:
                  link_access: none
                  space_id: 352d33c0-24ef-4a14-9fe6-8e414fb88151
                  space_key: TZFSoNmf
                  has_link_password: false
              schema:
                "$ref": "#/components/schemas/resource"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - current_id
              properties:
                current_id:
                  type: string
                  description: New Resource current id, if on one of resource versions
        required: true
  "/users/sign_in":
    post:
      summary: create session
      operationId: signIn
      description: Sign in user
      parameters: []
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                user:
                  id: e5c52123-2fad-473c-a24f-7142bfe717b1
                  email: jacqulyn.mante@hegmann.test
                  created_at: '2024-08-18T16:20:25.945Z'
                  updated_at: '2024-08-18T16:20:25.945Z'
                  guest: false
                  uid: 
                  provider: 
                redirect_url: "/"
        '401':
          description: Unauthorized
          content:
            application/json:
              example:
                errors: not authenticated
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
              - email
              - password
              properties:
                email:
                  type: string
                  description: User's email
                password:
                  type: string
                  description: User's password
  "/api/v1/resources/{id}/share-options":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show resource's share_options
      operationId: getShareOptions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                link_access: none
                space_id: 991d93e5-ae2f-493e-801e-05c365d7015e
                space_key: zL85GC6u
                has_link_password: false
    patch:
      summary: update resource's share_options
      operationId: updateShareOptions
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: unprocessable entity
          content:
            application/json:
              example:
                errors:
                  link_password:
                  - is too short (minimum is 8 characters)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_access:
                  type: string
                  description: Resource view access by link, possible values :none,
                    :view
                  enum:
                  - none
                  - view
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/resources/{id}/share-options/auth-password":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    post:
      summary: enter password for resource share_option
      operationId: resourceAuthPassword
      parameters: []
      responses:
        '204':
          description: successful
        '422':
          description: forbidden
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                link_password:
                  type: string
                  format: password
        required: true
  "/api/v1/versions/{id}":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: show version
      operationId: getVersion
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
                id: eecc07ff-d6b1-4a10-9081-a16dea839101
                space_id: b02ae031-350a-47b9-b511-05c0959bc14f
                space_key: l41QJguz
                resource_id: 428872d1-ff75-4b47-a2e0-bf50a31983f2
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              schema:
                "$ref": "#/components/schemas/version"
  "/api/v1/versions/{id}/files":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: files version
      operationId: getVersionFiles
      responses:
        '200':
          description: successful
          content:
            application/json:
              example: []
  "/api/v1/resources/{id}/versions":
    parameters:
    - name: id
      in: path
      description: Resource id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get versions
      operationId: getResourceVersions
      description: Resource versions, asset items each of which is versioned representation
        of resource
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 3e1dc00b-d7ad-4f40-96ae-6f7fbec35e86
                space_id: 514411fe-1fe9-4bd3-b8c4-4c874ea72dad
                space_key: 0alOS5HA
                resource_id: 46761089-951d-45b7-985e-2db32d8d293e
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: 7a276824-1259-4e80-a3d3-000928059483
                space_id: 514411fe-1fe9-4bd3-b8c4-4c874ea72dad
                space_key: 0alOS5HA
                resource_id: 46761089-951d-45b7-985e-2db32d8d293e
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: e6c83796-0ef8-4bf8-9f9d-707052c31cf9
                space_id: 514411fe-1fe9-4bd3-b8c4-4c874ea72dad
                space_key: 0alOS5HA
                resource_id: 46761089-951d-45b7-985e-2db32d8d293e
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
  "/api/v1/resources/{id}/asset-items":
    parameters:
    - name: id
      in: path
      description: Version id
      required: true
      schema:
        type: string
    - name: space-key
      in: header
      schema:
        type: string
    get:
      summary: get versions
      operationId: getResourceAssetItems
      description: Resource asset items, not only versions
      responses:
        '200':
          description: successful
          content:
            application/json:
              example:
              - id: 59bc1967-7656-49ab-b946-3e7746ef2122
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: false
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: ad937d50-12f6-45c4-863b-8d04b3d9958f
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: 7f9c379a-3a6c-402a-bd52-573351848c6a
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: false
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: 54b5e6d5-8e79-4a74-a84b-116f2367902d
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: 378ddc9b-7d15-48ae-92b3-2715d788a188
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: false
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              - id: 585e7300-96f4-4f72-87f8-2acd7a1fca97
                space_id: 6316211e-e62b-45a2-91d1-533eefbf78b6
                space_key: Eywy8MnX
                resource_id: 389deef3-828a-44e1-83eb-0aa90f33f5be
                status: ready
                is_version: true
                created_at: 2024-08-18 16:20:26 UTC
                updated_at: 2024-08-18 16:20:26 UTC
              schema:
                type: array
                items:
                  "$ref": "#/components/schemas/version"
components:
  schemas:
    resource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
        space_key:
          type: string
        name:
          type: string
        current_id:
          type: string
          format: uuid
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - id
      - space_id
      - space_key
      - name
      - created_at
      - updated_at
    version:
      type: object
      properties:
        id:
          type: string
          format: uuid
        space_id:
          type: string
        space_key:
          type: string
        status:
          "$ref": "#/components/schemas/version_status"
        resource_id:
          type: string
          format: uuid
        is_version:
          type: boolean
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
      required:
      - space_id
      - space_key
      - status
      - resource_id
      - is_version
      - created_at
      - updated_at
    version_status:
      type: string
      enum:
      - pending
      - in_progress
      - ready
      - failed
      - canceled
    conversion_task:
      type: object
      properties:
        status:
          type: string
          example: finished
        progress:
          type: string
        start_time:
          type: string
          format: date_time
          nullable: true
        end_time:
          type: string
          format: date_time
          nullable: true
        conversion_job_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date_time
        updated_at:
          type: string
          format: date_time
        meta:
          type: object
          properties:
            dest_resource_id:
              type: string
              nullable: true
            dest_version_id:
              type: string
              nullable: true
servers:
- url: http://{defaultHost}
  variables:
    defaultHost:
      default: localhost:3050
